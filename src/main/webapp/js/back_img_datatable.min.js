const TABLE_IMG_CONFIG={elem:"#datatable-img",height:470,url:"/myblog/getPageImgList",page:true,toolbar:"#toolbar",cols:[[{type:"checkbox",fixed:"left"},{field:"id",title:"ID",fixed:"left"},{field:"title",title:"标题"},{field:"src",title:"src"},{field:"createDateTime",title:"创建时间",sort:true,templet:function(a){return dateToStr(a.createDateTime)}},{field:"updateDateTime",title:"最后修改时间",width:170,sort:true,templet:function(a){return dateToStr(a.updateDateTime)}},{field:"mode",title:"模式",width:80,sort:true,templet:function(a){if(a.mode===0){return"已删除"}else{return"正常"}}},{fixed:"right",title:"操作",templet:"#opbar",width:180}]],response:{statusName:"status",statusCode:200,countName:"totalCount",msgName:"message"}};const $FORM_UPDATE_CONTAINER=$("#form-update-container");$(".exclamation").mouseover(function(){layer.tips("学习使我快乐！",".exclamation",{tips:1,time:1000})});function showLayer(a){$FORM_UPDATE_CONTAINER.removeClass("layui-hide");layer.open({type:1,title:"修改图片信息",closeBtn:1,shadeClose:true,content:$FORM_UPDATE_CONTAINER,success:function(){$("#form-update-container  input[name='id']").val(a.id);$("#form-update-container  input[name='title']").val(a.title);$("#form-update-container  input[name='src']").val(a.src)},end:function(){$FORM_UPDATE_CONTAINER.addClass("layui-hide")}})}function deleteImgById(c,a){const b=a?"真的移除么？会在文件系统中删除":"真的删除么？";layer.confirm(b,function(d){layer.close(d);$.ajax({url:"/myblog/deleteImgById",data:{id:c,remove:a},dataType:"json",method:"GET",success:function(e){if(e.status===200&&e.request==="success"){layer.msg(e.message)}else{layer.msg(e.message,function(){})}},error:function(){ajaxErrorNormal()}})})}function deleteChecked(c,a){const b=a?"确认移除么？":"确认删除么？";layer.confirm(b,function(d){layer.close(d);$.ajax({url:"deleteImgsByIdArray",data:{params:c,remove:a},dataType:"json",method:"GET",success:function(e){if(e.status===200&&e.request==="success"){layer.msg(e.message)}else{layer.msg(e.message,function(){})}},error:function(){ajaxErrorNormal()}})})}layui.use("table",function(){const a=layui.table;a.render(TABLE_IMG_CONFIG);a.on("tool(datatable-img)",function(d){const c=d.data;const b=d.event;if(b==="update"){showLayer(c)}else{if(b==="delete"){if(c.mode===0){layer.msg("已经删除！");return}deleteImgById(c.id,false)}else{if(b==="remove"){deleteImgById(c.id,true)}}}});a.on("toolbar(datatable-img)",function(f){const c=f.event;const b=a.checkStatus(f.config.id);const d=[];const e=b.data;if(e.length===0){layer.msg("请选中元素后再进行操作");return}for(let i=0;e.length!==0&&i<e.length;i++){d.push(e[i].id)}if(c==="deleteChecked"){deleteChecked(d,false)}else{if(c==="removeChecked"){deleteChecked(d,true)}}})});function updateImg(a){let load;$.ajax({url:"/myblog/updateImg",method:"POST",data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){layui.use("layer",function(){const b=layui.layer;load=b.load(3,{time:10*1000})})},success:function(b){if(b.status===200&&b.request==="success"){layer.msg(b.message)}else{layer.msg(b.message,function(){})}},complete:function(){layui.use("layer",function(){const b=layui.layer;b.close(load)})},error:function(){ajaxErrorNormal()}})}layui.use("form",function(){const a=layui.form;a.on("submit(btn-update)",function(c){const b=c.field;updateImg(b);return false})});layui.use("form",function(){const a=layui.form;a.on("submit(btn-search)",function(c){const b=c.field;if(b.id===""&&b.title===""){layui.use("table",function(){const d=layui.table;d.render(TABLE_IMG_CONFIG)})}else{layui.use("table",function(){const d=layui.table;d.reload("datatable-img",{url:"/myblog/searchImg",where:{id:b.id,title:b.title},page:{curr:1}})})}return false})});